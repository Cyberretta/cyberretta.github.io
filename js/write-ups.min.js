/*!
 * Copyright Jean-Loup Laverny (Cyberretta)
 * All rights reserved.
 */
const e={platform:["HackTheBox","TryHackMe"],difficulty:["Very easy","Easy","Medium","Hard","Insane"],os:["Windows","Linux","Non spécifié"]};let t={name:"",platform:[],difficulty:[],os:[],tags:[],page:1},n={name:"",platform:[],difficulty:[],os:[],tags:[],page:1},s="",a=[];function l(e,t){const n=t.toLowerCase();return e.some((e=>e.toLowerCase()===n))}function i(e,t){for(child of e)if(!l(t,child))return!1;return!0}function c(){a=[];let e=s.WriteUps;for(let n=0;n<e.length;n++){let s=!0;for(key in t)if(Array.isArray(t[key]))Array.isArray(e[n][key])?0!==t[key].length&&(i(t[key],e[n][key])||(s=!1)):0!==t[key].length&&(t[key].includes(e[n][key])||(s=!1));else if("string"==typeof t[key]&&t[key]&&!e[n][key].includes(t[key])){s=!1;break}!0===s&&a.push(e[n])}a.length>0?m():document.getElementById("writeUpsList").innerHTML='<p class="errorMessage">Désolé, aucun résultat ne correspond à votre recherche.</p>',function(){const e=Math.ceil(a.length/6);let n="";for(let t=1;t<=e;t++)n+=`<div class="pageButton"><p>${t}</p></div>`;const s=document.getElementsByClassName("pagesContainer")[0];s.innerHTML=n;let l=s.getElementsByTagName("div");if(l.length>0){for(let e=0;e<l.length;e++)l[e].addEventListener("click",r);t.page=1,l[0].className="pageButton active"}}()}function o(e){if(!n.tags.includes(e)){let t=document.getElementById("container_tags"),s=document.createElement("div");s.className="tag",t.appendChild(s);let a=document.createElement("p");a.innerText=e,s.appendChild(a);let l=document.createElement("img");l.src="/img/remove.png",s.appendChild(l),s.addEventListener("click",(e=>function(e){let t=e.target.innerText;n.tags.splice(n.tags.indexOf(t),1),e.target.closest("div").remove();let s=document.getElementById("container_tags");if(0==n.tags.length){let e=s.getElementsByTagName("p")[0];e.className.includes(" hidden")&&(e.className=e.className.replace(" hidden",""))}p()}(e)));let i=t.getElementsByTagName("p")[0];i.className.includes(" hidden")||(i.className+=" hidden"),n.tags.push(e),p()}}function r(){if("pageButton active"!==this.className){const e=this.parentElement.getElementsByClassName("pageButton");for(let t=0;t<e.length;t++)e[t].className="pageButton";t.page=Number(this.getElementsByTagName("p")[0].innerText),this.className="pageButton active",m()}}function m(){document.getElementById("writeUpsList").innerHTML="";const e=6*(t.page-1);end=e+6,end>a.length&&(end=a.length);for(let t=e;t<end;t++){let e=a[t],n=e.difficulty;"Very easy"==n&&(n="Easy");let s=document.createElement("a");s.className=`writeUpBlock ${n}`,s.href=`/write-ups/read.html?platform=${e.platform}&difficulty=${e.difficulty}&name=${e.name}`;let l=document.createElement("div");l.className="header";let i=document.createElement("img");i.className="platformIcon",i.src=`/img/${e.platform.toLowerCase()}.png`;let c=document.createElement("p");c.className="boxTitle",c.innerHTML=e.name,l.appendChild(i),l.appendChild(c),s.appendChild(l);let o=document.createElement("img");o.className="boxIcon",o.src=e.icon,"Sherlock"===e.type&&(o.style.borderRadius=0),s.appendChild(o);let r=document.createElement("div");r.className="boxInformation",s.appendChild(r);let m=document.createElement("div");m.className="osContainer",m.innerHTML=`<p>OS : </p><img class="osIcon" src="/img/os/${e.os.toLowerCase()}.png"/>`,r.appendChild(m);let g=document.createElement("div");g.class="difficultyContainer",g.innerHTML=`<p class="difficulty">Difficulté : ${e.difficulty}</p>`,r.appendChild(g);let p=document.createElement("div");p.addEventListener("scroll",(e=>d(e))),p.className="tagsContainer";let u=e.tags;for(let e=0;e<u.length;e++){let t=document.createElement("p");t.className="tag",t.innerText=u[e].toLowerCase(),t.addEventListener("click",(e=>f(e))),p.appendChild(t)}r.appendChild(p),document.getElementById("writeUpsList").appendChild(s)}}function d(e){const t=e.target;t.scrollTop,t.scrollHeight,t.clientHeight}function g(){let e=document.getElementById("searchBox").getElementsByClassName("button");for(let t=0;t<e.length;t++)e[t].disabled=!0}function p(){let e=!1;for(key in n)if("page"!==key)if(Array.isArray(n[key])){if(n[key].length!=t[key].length||!n[key].every((function(e,n){return e===t[key][n]}))){e=!0;break}}else if(n[key]!==t[key]){e=!0;break}!0===e?function(){let e=document.getElementById("searchBox").getElementsByClassName("button");for(let t=0;t<e.length;t++)e[t].disabled=!1}():g()}function u(){let e=this.getElementsByClassName("checkBox")[0];"checkBox checked"===e.className?e.className="checkBox":e.className="checkBox checked";let t=this.parentElement.parentElement.getElementsByClassName("head")[0].getElementsByClassName("selectionContainer")[0].getElementsByClassName("selection")[0],n=this.parentElement.getElementsByClassName("entry"),s=[];t.innerText="";for(let e=0;e<n.length;e++)"checkBox checked"===n[e].getElementsByClassName("checkBox")[0].className&&s.push(n[e].getElementsByClassName("entryText")[0].innerText);if(s.length>0){for(let e=0;e<s.length;e++)t.textContent+=s[e],e<s.length-1&&(t.textContent+=", ");t.className="selection"}else t.textContent="Aucun filtre",t.className="selection empty";N(),p()}function f(e){e.preventDefault(),o(e.target.innerText.toLowerCase())}function y(){this.parentElement.focus(),"comboBox active"===this.parentElement.className?this.parentElement.className="comboBox":this.parentElement.className="comboBox active"}function h(){this.className="comboBox"}function E(){let e=this.id.split("_")[1];n[e]=this.text,N(),p()}function B(e){if("insertParagraph"==e.inputType){e.preventDefault();let s=e.target.id.split("_")[1];n[s]=e.target.innerText,g(),t=JSON.parse(JSON.stringify(n)),c()}}function N(){const e=document.getElementById("searchBox").getElementsByClassName("comboBox");for(const t of e){const e=t.id.split("_")[1],s=t.getElementsByClassName("entry");let a=[];for(let e=0;e<s.length;e++){const t=s[e];"checkBox checked"===t.getElementsByClassName("checkBox")[0].className&&a.push(t.getElementsByClassName("entryText")[0].innerText)}n[e]=JSON.parse(JSON.stringify(a))}const t=document.getElementById("searchBox").getElementsByClassName("inputText");for(const e of t){const t=e.id.split("_")[1];n[t]=e.innerText}}function C(){g(),t=JSON.parse(JSON.stringify(n)),c()}function k(){}function x(){(function(){let t=document.getElementsByClassName("comboBox");for(let n=0;n<t.length;n++){let s=t[n].id.split("_")[1];if(s in e){let a=e[s];for(let e=0;e<a.length;e++)t[n].getElementsByClassName("entriesList")[0].innerHTML+=`<div class="entry"><div class="checkBox"></div><p class="entryText">${a[e]}</p></div>`}let a=t[n].getElementsByClassName("entriesList")[0].getElementsByClassName("entry");for(let e=0;e<a.length;e++)a[e].addEventListener("click",u);t[n].getElementsByClassName("head")[0].addEventListener("click",y),t[n].addEventListener("focusout",h)}const n=document.getElementById("searchBox").getElementsByClassName("inputText");for(const e of n)e.addEventListener("input",E),e.addEventListener("beforeinput",(e=>B(e)))})(),function(){const e=document.getElementById("searchBox").getElementsByClassName("button apply")[0],t=document.getElementById("searchBox").getElementsByClassName("button reset")[0];e.addEventListener("click",C),t.addEventListener("click",k)}(),document.getElementsByClassName("addTagContainer")[0].getElementsByClassName("addTagInput")[0].addEventListener("beforeinput",(e=>{if("insertParagraph"==e.inputType){e.preventDefault();let t=e.target.innerText.toLowerCase();""!==t&&(o(t),e.target.innerText="")}}))}window.addEventListener("DOMContentLoaded",(()=>{fetch("/write-ups/write-ups.json",{}).then((e=>e.json())).then((e=>{s=e,c()})),x()}));